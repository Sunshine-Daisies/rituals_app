# Copilot Project Prompt ‚Äî Personalized Daily Rituals# Copilot Project Prompt ‚Äî Personalized Daily Rituals



**Role:** You are my pair programmer and project planner for a mobile & web app called **Personalized Daily Rituals**.**Role:** You are my pair programmer and project planner for a mobile app called **Personalized Daily Rituals**.

**Stack:** Flutter (Web & Android), **Supabase** (Auth/DB/Realtime/Edge Functions), **OpenAI API** (GPT-4o/GPT-4o-mini for AI chat & intent extraction).**Stack:** Flutter (frontend), **Supabase** (Auth/DB/Realtime/Edge Functions), **Ollama** on Mac mini (AI intent extraction).

**Goal:** A *finished-product* demo: sign-in ‚Üí chat to create/edit rituals ‚Üí manage via UI ‚Üí reminders ‚Üí checklist run ‚Üí stats.**Goal:** A *finished-product* demo: sign-in ‚Üí chat to create/edit rituals ‚Üí manage via UI ‚Üí reminders ‚Üí checklist run ‚Üí stats.



---## Product Summary



## Product Summary* Chat-first UX: user types natural language; AI returns **structured JSON intents** (create/edit/start/snooze/stats).

* UI complement: ritual cards, detail with reorder/remove steps, checklist run, notifications, stats/streaks.

* **Chat-first UX**: user types natural language; AI returns **structured JSON intents** (create/edit/start/snooze/stats).* Single source of truth: Supabase (auth + Postgres + realtime + optional edge functions).

* **UI complement**: ritual cards, detail with reorder/remove steps, checklist run, notifications, stats/streaks.* AI is **remote** on Mac mini (Ollama). App talks to AI via a lightweight HTTP gateway (either directly or via Supabase Edge Function proxy).

* **Single source of truth**: Supabase (auth + Postgres + realtime + optional edge functions).

* **AI Integration**: OpenAI API (GPT-4o for chat, GPT-4o-mini for intent extraction).## Deliverables (ask me step-by-step; don't dump everything at once)

* **Platforms**: Web (PWA) + Android only (iOS/macOS/Linux removed for faster iteration).

1. **Flutter app scaffolding** ‚úÖ COMPLETED

---

   * ‚úÖ Packages: `supabase_flutter`, `riverpod`, `flutter_local_notifications` (temp. removed), `fl_chart`, `go_router`.

## Current Status ‚úÖ   * ‚úÖ App layers: `data/`, `services/`, `features/`, `widgets/`, `routes/`.

   * ‚úÖ Screens: Auth, Home, Chat, Ritual Detail, Checklist Run, Stats.

### **Completed:**   * ‚úÖ Router with auth protection (temp. disabled)

1. ‚úÖ **Flutter app scaffolding**   * ‚úÖ Basic models: Ritual, RitualStep, RitualRun, ChatMessage

   - Packages: `supabase_flutter`, `flutter_riverpod`, `go_router`, `dart_openai`, `flutter_dotenv`, `fl_chart`

   - App layers: `lib/data/`, `lib/services/`, `lib/features/`, `lib/widgets/`, `lib/routes/`2. **Supabase setup** ‚è≥ READY TO START

   - Screens: Auth, Home, Chat, Ritual Detail, Checklist Run, Stats

   - Models: Ritual, RitualStep, RitualRun, ChatMessage   * SQL schema & migrations for:



2. ‚úÖ **OpenAI Integration** (`lib/services/llm_service.dart`)     * `users(id, email, display_name, created_at)`

   - GPT-4o for conversational chat     * `rituals(id, user_id, name, time, days text[])`

   - GPT-4o-mini for structured JSON intent extraction     * `ritual_steps(id, ritual_id, title, order_no)`

   - `RitualIntent` class for parsing AI responses     * `ritual_runs(id, ritual_id, started_at, progress jsonb)`

   - Environment-based API key management via `.env`     * `devices(id, user_id, fcm_token, platform)`

   * **RLS policies** so users access only their own rows (`auth.uid() = user_id`).

3. ‚úÖ **Supabase Authentication** (`lib/services/supabase_service.dart`)   * **Realtime** enabled for rituals/steps/runs.

   - Email/password auth with secure initialization

   - Sign up, sign in, sign out, session management3. **Edge Functions (Supabase)**

   - Environment-based URL and key configuration

   * (A) **Push notifier**: cron-like trigger that reads due rituals and sends FCM (Android first).

4. ‚úÖ **Complete Auth Flow** (`lib/features/auth/auth_screen.dart`)   * (B) **AI proxy** (optional): POST user message ‚Üí forward to **Mac mini Ollama** ‚Üí return `intent+args` JSON. (Use simple auth and rate limiting.)

   - Login/signup form with validation

   - Error handling and user feedback4. **Ollama gateway (Mac mini)**

   - Auto-navigation on successful auth

   - Professional UI with Material 3 design   * Endpoint that accepts `{ message, user_id }` and returns:



5. ‚úÖ **Home Dashboard** (`lib/features/home/home_screen.dart`)     ```json

   - User info display     { "reply":"‚Ä¶", "tool_calls":[{"name":"create_ritual","args":{‚Ä¶}}, ‚Ä¶] }

   - Quick action cards (New Ritual, View Stats, Chat)     ```

   - Logout functionality   * Keep responses concise; intents must be valid JSON with 24h time, ISO dates, and Turkish text.

   - Responsive layout

5. **Flutter integration**

6. ‚úÖ **Router with Auth Guards** (`lib/routes/app_router.dart`)

   - Protected routes with auth state checks   * Auth flow (Supabase).

   - Redirect logic for unauthenticated users   * Data layer for rituals/steps/runs using Supabase client.

   - Deep linking support   * **Chat controller**: send text ‚Üí call AI proxy ‚Üí execute tool_calls against Supabase (insert/update) ‚Üí render special cards (checklist/stats).

   * Realtime subscriptions to reflect changes instantly.

7. ‚úÖ **Platform Cleanup**   * Notifications: register FCM token ‚Üí store in `devices` ‚Üí deep link to Chat with quick actions (Start / Snooze).

   - Removed iOS, macOS, Linux platforms

   - Optimized for Web & Android only6. **Stats**

   - Updated Docker configuration for web deployment

   * Backend query for last 7/30 days completion.

8. ‚úÖ **DevOps Setup**   * Frontend charts with `fl_chart`.

   - Dockerfile for Flutter web builds   * Streak calculation.

   - docker-compose.yml for local development

   - Environment variable management7. **Quality**



---   * Error handling (unknown intent ‚Üí friendly fallback with quick replies).

   * Basic analytics logs (non-PII).

## Next Steps üöÄ   * Light theming: dark mode, small success animation when a ritual completes.



### **TODO:**## Conventions

1. ‚è≥ **Supabase Database Schema**

   - SQL schema & migrations for:* **Languages:** TR for user-facing text; code/comments in EN.

     - `users(id, email, display_name, created_at)`* **Naming:** snake_case for SQL, lowerCamel for Dart.

     - `rituals(id, user_id, name, time, days text[])`* **Commits:** conventional commits (`feat:`, `fix:`, `chore:`, `docs:`).

     - `ritual_steps(id, ritual_id, title, order_no)`* **Env:** never hardcode secrets; use `.env` and Supabase config.

     - `ritual_runs(id, ritual_id, started_at, progress jsonb)`

     - `devices(id, user_id, fcm_token, platform)`## Acceptance Criteria (per feature)

   - **RLS policies** so users access only their own rows (`auth.uid() = user_id`)

   - **Realtime** enabled for rituals/steps/runs* Auth: can sign up, sign in, sign out; protected routes work.

* Chat‚ÜíIntent‚ÜíDB: "Ak≈üam rutinime 10 dk okuma ekle, 21:30 yap" updates DB and UI in realtime.

2. ‚è≥ **Data Layer Implementation*** Ritual Detail: drag to reorder; swipe to delete.

   - Repository pattern for CRUD operations* Checklist Run: mark step done/skip; progress % updates.

   - Riverpod providers for state management* Notifications: scheduled push arrives; tapping opens Chat with "Ba≈ülat/Erteler misin?".

   - Realtime subscriptions for live updates* Stats: weekly/monthly charts and streak numbers render correctly.



3. ‚è≥ **Chat Controller Integration**## How I'll talk to you

   - Wire chat UI to `LlmService`

   - Parse `RitualIntent` and execute DB operations* When I say **"scaffold Flutter app"**, generate the minimal files and pubspec additions‚Äîno dummy boilerplate beyond what's needed.

   - Render special cards (checklist/stats) in chat* When I say **"create Supabase schema"**, output SQL migrations + RLS.

* When I say **"edge function for push"**, create function code + deploy steps + env hints.

4. ‚è≥ **Ritual Management UI*** When I say **"wire chat to AI"**, define the HTTP call, models, error handling, and a tiny example of `tool_calls`.

   - Ritual list with cards* Always propose small, verifiable steps; include short run/test instructions.

   - Ritual detail screen (edit, reorder steps, delete)* If something is ambiguous, propose a sensible default and move on.

   - Step management with drag-to-reorder

   - Swipe to delete gestures---



5. ‚è≥ **Checklist Run Feature****Status:** ‚úÖ Flutter app scaffolding complete. Next step: **create Supabase schema**.
   - Step-by-step checklist interface
   - Progress tracking
   - Mark as done/skip
   - Completion celebration

6. ‚è≥ **Push Notifications**
   - FCM integration for Android
   - Supabase Edge Function for scheduled reminders
   - Deep linking to Chat with quick actions (Start/Snooze)

7. ‚è≥ **Stats & Analytics**
   - Weekly/monthly completion charts (fl_chart)
   - Streak calculation
   - Progress insights

8. ‚è≥ **Polish & Quality**
   - Error handling with friendly fallbacks
   - Loading states and animations
   - Dark mode support
   - Success animations
   - Basic analytics (non-PII)

---

## Technical Details

### **Environment Variables** (`.env`)
```env
OPENAI_API_KEY=sk-...
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_ANON_KEY=eyJ...
```

### **Key Services**
- **LlmService** (`lib/services/llm_service.dart`): OpenAI API wrapper
- **SupabaseService** (`lib/services/supabase_service.dart`): Auth & DB client
- **AppRouter** (`lib/routes/app_router.dart`): Navigation with auth guards

### **Project Structure**
```
lib/
‚îú‚îÄ‚îÄ main.dart                 # Entry point with dotenv & Supabase init
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îî‚îÄ‚îÄ app_router.dart       # Go Router with auth guards
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ llm_service.dart      # OpenAI integration
‚îÇ   ‚îî‚îÄ‚îÄ supabase_service.dart # Supabase client
‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îú‚îÄ‚îÄ auth/                 # Login/signup screens
‚îÇ   ‚îú‚îÄ‚îÄ home/                 # Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ chat/                 # AI chatbot (pages/)
‚îÇ   ‚îú‚îÄ‚îÄ ritual_detail/        # Ritual management
‚îÇ   ‚îú‚îÄ‚îÄ checklist/            # Daily checklist
‚îÇ   ‚îî‚îÄ‚îÄ stats/                # Analytics & charts
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ models/               # Data models
‚îÇ   ‚îî‚îÄ‚îÄ repositories/         # Data access layer
‚îî‚îÄ‚îÄ widgets/                  # Reusable components
```

---

## Conventions

* **Languages:** TR for user-facing text; code/comments in EN.
* **Naming:** snake_case for SQL, lowerCamelCase for Dart.
* **Commits:** conventional commits (`feat:`, `fix:`, `chore:`, `docs:`).
* **Env:** never hardcode secrets; use `.env` and Supabase config.
* **Platforms:** Web & Android only (for now).

---

## Acceptance Criteria (per feature)

* ‚úÖ **Auth**: can sign up, sign in, sign out; protected routes work.
* ‚è≥ **Chat‚ÜíIntent‚ÜíDB**: "Ak≈üam rutinime 10 dk okuma ekle, 21:30 yap" updates DB and UI in realtime.
* ‚è≥ **Ritual Detail**: drag to reorder; swipe to delete.
* ‚è≥ **Checklist Run**: mark step done/skip; progress % updates.
* ‚è≥ **Notifications**: scheduled push arrives; tapping opens Chat with "Ba≈ülat/Ertele".
* ‚è≥ **Stats**: weekly/monthly charts and streak numbers render correctly.

---

## How to Interact with Me

* When I say **"create Supabase schema"**, output SQL migrations + RLS policies.
* When I say **"implement ritual repository"**, create repository pattern with CRUD operations.
* When I say **"wire chat to DB"**, integrate LlmService ‚Üí parse intent ‚Üí execute DB operations.
* When I say **"add realtime subscriptions"**, set up Supabase realtime listeners.
* Always propose small, verifiable steps; include run/test instructions.
* If something is ambiguous, propose a sensible default and move on.

---

**Current Focus:** Ready to push to GitHub with platform cleanup and Docker setup. Next milestone: **Supabase database schema & RLS policies**.
